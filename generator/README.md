# SyzGPT-generator

We have open-souced the augmented syscall depencies at [../data/dependencies](../data/dependencies/). So you can directly run SyzGPT without extract syscall dependency anymore.

You can also extract the syscall dependencies on your own, please refer to [../extractor/README.md](../extractor/README.md).

## 1 Setup

1. Install dependencies:

```bash
cd ~/SyzGPT
pip install -r requirements.txt
```

2. Config API_KEY in **private_config.py** (Call-level dependency extraction will use LLM)

```bash
# for security concern
cp config.py private_config.py
# and then edit API_KEY in private_config.py
```

## 2 Usage

### 2.1 One-time seed generation


```bash
# suppose you have: (1) a corpus.db generated by at least a 24-hour Syzkaller or some (2) the target syscall list
# cd the root of this project
python syzgpt_generator.py -s /root/fuzzers/SyzGPT-fuzzer -w WORKDIR -e /path/to/existing_corpus.db -f target_syscall_list.txt 
```

Explanation of Parameters (refer to [generator/README.md](generator/README.md) for more details):
- `-s`: path to the SyzGPT-fuzzer, must be specified.
- `-w`: output the generated results and logs to `WORKDIR`, must be specified.
- `-e`: path to external corpus, only nessary in one-time seed generation.
- `-f`: path to the file containing target syscall list, only needed in one-time seed generation.
- `-c`: you can also specify the target syscalls through `-c CALL1 CALL2 CALL3 ...` manually.

You will find the outputs in `WORKDIR` look like:

```bash
├── external_corpus/            # external corpus specified through -e
├── generated_corpus/           # generated seeds in Syz-program format
├── generation_history.json     # generation history for feedback-guided seed generation
├── query_prompts/              # generation logs including query prompts and results, which can be used for fine-tuning.
├── reverse_index.json          # reverse index for DRAG
└── target_syscalls/            # generation targets
```

### 2.2 Loop seed generation (for fuzzing)


1. Run SyzGPT-fuzzer:

```bash
# cd the location where you setup SyzGPT-fuzzer
taskset -c 8-15 ./bin/syz-manager -config /root/SyzGPT/fuzzer/cfgdir/SyzGPT.cfg -bench benchdir/SyzGPT.log -statcall -backup 24h -enrich WORKDIR/generated_corpus -period 1h -repair
```

Explanation of Parameters (refer to [fuzzer/README.md](fuzzer/README.md) for more details):
- `-statcall`: enable syscall tracking during fuzzing.
- `-backup`: backup **rawcover**, **corpus.db**, **CoveredCalls**, and **crahes** every 24h.
- `-enrich`: load the enriched seeds from `WORKDIR/generated_corpus` every `INTERNAL` (1h).
- `-period`: `INTERVAL` of loading enriched seeds.
- `-repair`: enable program repair which is implemented in SyzGPT-fuzzer.

2. Run SyzGPT-generator:

```bash
# cd the root of this project
python syzgpt_generator.py -s /root/fuzzers/SyzGPT-fuzzer -w /root/fuzzers/SyzGPT-fuzzer/workdir/v6-1/SyzGPT/generated_corpus -D 1h -T 1h -S 24h -m 100 -P 10
```

Explanation of Parameters (refer to [generator/README.md](generator/README.md) for more details):
- `-s` and `-w` have been introduced above.
- `-D`: An empirical delay (1h) before generator start to work, which leave the fuzzer to explore by default.
- `-T`: generate seeds every `INTERVAL` (1h), need to be in the same pace with `-enrich` in fuzzer.
- `-S`: stop generating after 24h.
- `-m`: max generation amount, 100 here.
- `-P`: probability of feedback-guided re-generation for failed seeds, 10% here.
